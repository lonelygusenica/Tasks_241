# BASH

**1) Что такое шебанг?**  
Shebang — это первая строка в скрипте, начинающаяся с #!, которая указывает на интерпретатор, который будет использоваться для выполнения скрипта  

**2) Обязательно ли исполняемый файл дожен иметь соотвествующее расширение?**  
Нет, важно чтобы файл имел права на выполнение, а также корректно указывался интерпретатор через шебанг, если это необходимо.  

**3) Напишите скрипт который выполнит автоматически действия из блока работы с файлами. ( не забудьте включить set -euo pipefail для того что бы ваш скрипт было удобнее отлаживать. Опишите что включают эти флаги)**  
- **set -e** заставляет скрипт прекратить выполнение, если любая команда завершится с ошибкой.  
- **set -u** вызывает ошибку, если в скрипте будет использована необъявленная переменная.  
- **set -o pipefail** гарантирует, что если какая-либо команда в пайплайне завершится с ошибкой, это отразится на статусе выполнения скрипта.  
```
#!/bin/bash

# Добавление и настройка нового жесткого диска

# Функция для проверки выполнения скрипта с правами суперпользователя
check_root() {
if [[ $EUID -ne 0 ]]; then
echo "Этот скрипт должен быть запущен с правами суперпользователя (root)."
exit 1
fi
}

# Функция для вывода содержимого /etc/fstab
display_fstab() {
echo "=============================="
echo "1. Содержимое /etc/fstab"
echo "=============================="
cat /etc/fstab
echo
}

# Функция для инструкции по добавлению диска вручную
instruction_add_disk() {
echo "=========================================================="
echo "2. Добавьте в виртуальную машину ещё один диск вручную."
echo " После добавления диска, нажмите Enter для продолжения..."
echo "=========================================================="
read -p "Нажмите Enter после добавления диска..."
}

# Функция для отображения информации о блочных устройствах
show_block_devices() {
echo "============================================"
echo "3. Информация о блочных устройствах (lsblk)"
echo "============================================"
lsblk
echo
}

# Функция для создания разделов и файловой системы на новом диске
create_partition_and_fs() {
echo "==============================================="
echo "4. Создание таблицы разделов и файловой системы ext4 на $NEW_DISK"
echo "==============================================="

# Создание таблицы разделов с помощью fdisk
echo "Создание новой таблицы разделов на $NEW_DISK..."
(
echo o # Создать новую пустую DOS таблицу разделов
echo n # Добавить новый раздел
echo p # Основной раздел
echo 1 # Номер раздела
echo # Первый сектор (по умолчанию)
echo # Последний сектор (по умолчанию)
echo w # Записать изменения и выйти
) | fdisk "$NEW_DISK"

# Обновление таблицы разделов
partprobe "$NEW_DISK"

# Определение раздела
PARTITION="${NEW_DISK}1"

# Проверка создания раздела
if [ ! -b "$PARTITION" ]; then
echo "Ошибка: Раздел $PARTITION не был создан."
exit 1
fi

# Создание файловой системы ext4
echo "Создание файловой системы ext4 на $PARTITION..."
mkfs.ext4 "$PARTITION"

echo
}

# Функция для монтирования диска в /mnt
mount_disk() {
echo "======================================="
echo "5. Монтирование диска в /mnt"
echo "======================================="
mkdir -p /mnt
mount "$PARTITION" /mnt
echo
}

# Функция для создания файлов в /mnt
create_files() {
echo "=============================="
echo "6. Создание файлов в /mnt"
echo "=============================="
cd /mnt
touch example1.txt example2.txt
ls -l
echo
}

# Функция для отмонтирования диска и проверки файлов
unmount_and_check_files() {
echo "==========================================="
echo "7. Отмонтирование диска и проверка файлов"
echo "==========================================="
cd ~
umount /mnt

echo "Повторное монтирование диска для проверки файлов..."
mount "$PARTITION" /mnt
echo "Содержимое /mnt:"
ls /mnt
echo
}

# Функция для добавления диска в /etc/fstab
add_to_fstab() {
echo "==========================================="
echo "8. Добавление диска в /etc/fstab для автоподключения"
echo "==========================================="

# Получение UUID раздела
UUID=$(blkid -s UUID -o value "$PARTITION")
if [ -z "$UUID" ]; then
echo "Ошибка: Не удалось получить UUID для $PARTITION."
exit 1
fi

# Резервное копирование /etc/fstab
echo "Создание резервной копии /etc/fstab в /etc/fstab.bak..."
cp /etc/fstab /etc/fstab.bak

# Проверка, существует ли запись в fstab уже
if grep -q "UUID=$UUID" /etc/fstab; then
echo "Запись с UUID=$UUID уже существует в /etc/fstab. Пропуск добавления."
else
# Добавление
09:54


записи в /etc/fstab
echo "Добавление записи в /etc/fstab..."
echo "UUID=$UUID /mnt ext4 defaults 0 2" » /etc/fstab
fi
echo
}

# Функция для проверки корректности записей в /etc/fstab
verify_fstab() {
echo "==========================================="
echo "9. Проверка корректности записей в /etc/fstab"
echo "==========================================="
mount -a

if mountpoint -q /mnt; then
echo "Диск успешно смонтирован согласно /etc/fstab."
else
echo "Ошибка: Диск не смонтирован. Проверьте файл /etc/fstab."
exit 1
fi
echo
}

# Функция для перезагрузки системы
reboot_system() {
echo "=============================="
echo "10. Перезагрузка системы"
echo "=============================="
read -p "Система будет перезагружена. Нажмите Enter для продолжения..."
reboot
}

# Основная функция для выполнения всех шагов
main() {
check_root
display_fstab
instruction_add_disk
show_block_devices

# Определение нового диска
# Предполагается, что новый диск /dev/sdb
# Если имя диска отличается, измените значение переменной ниже
NEW_DISK="/dev/sdb"

# Проверка существования диска
if [ ! -b "$NEW_DISK" ]; then
echo "Ошибка: Диск $NEW_DISK не найден. Проверьте, правильно ли добавлен диск."
exit 1
fi

create_partition_and_fs
mount_disk
create_files
unmount_and_check_files
add_to_fstab
verify_fstab
reboot_system
}

# Запуск основной функции
main
```
